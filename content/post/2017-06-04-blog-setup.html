---
title: Blog Setup
subtitle: 'An overview of how I set up this blog'
author: Matt Flor
date: '2017-06-04'
slug: blog-setup
categories:
  - R
  - Setup
tags:
  - blogdown
  - Hugo
  - R Markdown
output:
    blogdown::html_page:
        toc: true
description: 'This post is meant as an aide memoire for myself of the steps I went through to set up this blog.
But maybe it can be helpful for others as well.'
---


<div id="TOC">
<ul>
<li><a href="#server">Server</a></li>
<li><a href="#blogdown">blogdown</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration-and-tweaks">Configuration and Tweaks</a><ul>
<li><a href="#config.toml">config.toml</a></li>
<li><a href="#custom.css">custom.css</a></li>
<li><a href="#list.html">list.html</a></li>
<li><a href="#logo-and-favicon">logo and favicon</a></li>
<li><a href="#rprofile">.Rprofile</a></li>
</ul></li>
</ul></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#workflow">Workflow</a></li>
</ul>
</div>

<p>This post is meant as an aide memoire for myself of the steps I went through to set up this blog. But maybe it can be helpful for others as well.</p>
<div id="server" class="section level1">
<h1>Server</h1>
<p>My blog is hosted on a <a href="https://www.1blu.de/server/vserver/">1blu vServer</a> with a Plesk-free Ubuntu 16.04 installation with an Apache webserver. I can conveniently login to the server via ssh. Enabling HTTPS via a <a href="https://letsencrypt.org/">Let’s Encrypt</a> certificate was a cinch with <a href="https://certbot.eff.org/#ubuntuxenial-apache">certbot</a>.</p>
</div>
<div id="blogdown" class="section level1">
<h1>blogdown</h1>
<p><a href="https://github.com/rstudio/blogdown">blogdown</a> is an R package (still in beta at the moment) for creating websites written in <a href="http://rmarkdown.rstudio.com/">R Markdown</a>. It uses the static site generator <a href="https://gohugo.io/">Hugo</a> enhancing it with <a href="https://yihui.name/knitr/">knitr</a> magic. There is an online book documenting the process of how to set everything up at <a href="https://bookdown.org/yihui/blogdown/" class="uri">https://bookdown.org/yihui/blogdown/</a>. As of this writing the book is still in the making but it should be more than sufficient to get you started<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>First, I created a new project in RStudio and installed blogdown &amp; Hugo:</p>
<pre class="r"><code>devtools::install_github(&quot;rstudio/blogdown&quot;)
blogdown::install_hugo()</code></pre>
<p>The default theme that comes with blogdown isn’t bad but I had a look around at <a href="http://themes.gohugo.io/">Hugo Themes</a> anyways and decided to go with <a href="http://themes.gohugo.io/beautifulhugo/">Beautiful Hugo</a>.</p>
<p>So I called</p>
<pre class="r"><code>blogdown::new_site(theme = &quot;halogenica/beautifulhugo&quot;)</code></pre>
<p>and the site was live with some example content (including a site configuration file, see <a href="#config.toml">config.toml</a> below), at least locally.</p>
<p>I also put the whole project under version control, so you can in fact look at the GitHub repository of this blog at <a href="https://github.com/mattflor/www.mattflor.de" class="uri">https://github.com/mattflor/www.mattflor.de</a>.</p>
</div>
<div id="configuration-and-tweaks" class="section level2">
<h2>Configuration and Tweaks</h2>
<p>Here, I’ll list things I tweaked to my liking so I do not forget.</p>
<div id="config.toml" class="section level3">
<h3>config.toml</h3>
<p>Most variables you can configure in the <code>config.toml</code> file for your website are pretty straightforward and self-explanatory: base URL of your website, your name, social media handles, &amp;c. Just fill in your details and comment out (or delete) stuff you don’t need. For a list of Hugo’s configuration variables, see <a href="https://gohugo.io/overview/configuration./" class="uri">https://gohugo.io/overview/configuration./</a></p>
<p>From blogdown’s default theme I adopted the following:</p>
<ul>
<li><p>Tell Hugo to ignore files generated by the blogdown environment:</p>
<pre><code>ignoreFiles = [&quot;\\.Rmd$&quot;, &quot;_files$&quot;, &quot;_cache$&quot;]</code></pre></li>
<li><p>Add nice permalinks for blog posts:</p>
<pre><code>[permalinks]
    post = &quot;/:year/:month/:day/:slug/&quot;</code></pre></li>
<li><p>Use <a href="https://highlightjs.org/">highlight.js</a> for code highlighting (instead of pygments):</p>
<pre><code>[Params]
    # options for highlight.js (version, additional languages, and theme)
    highlightjsVersion = &quot;9.11.0&quot;
    highlightjsCDN = &quot;//cdn.bootcss.com&quot;
    highlightjsLang = [&quot;r&quot;, &quot;yaml&quot;]
    highlightjsTheme = &quot;github&quot;</code></pre></li>
</ul>
<p>The <code>[[menu.main]]</code> parts control the navigation bar of the website. I commented out the “Samples” entries, added a “Categories” one, and edited the weights variables of the entries to change their order in the navigation bar.</p>
</div>
<div id="custom.css" class="section level3">
<h3>custom.css</h3>
<p>I wanted a slightly different font color scheme so I copied the file <code>./themes/beautifulhugo/static/css/main.css</code> to <code>./static/css/custom.css</code>, removed everything not pertaining to colors, and changed the HTML color codes to my prefered ones. For Hugo to pick this additional stylesheet up, I followed <a href="https://discuss.gohugo.io/t/how-to-override-css-classes-with-hugo/3033/4" class="uri">https://discuss.gohugo.io/t/how-to-override-css-classes-with-hugo/3033/4</a>: In <code>config.toml</code>, add</p>
<pre><code>[Params]
    custom_css = [&quot;css/custom.css&quot;]</code></pre>
<p>and in <code>./layouts/partials/head_custom.html</code>, add</p>
<pre><code>{{ range .Site.Params.custom_css }}
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ $.Site.BaseURL }}{{ . }}&quot;&gt;
{{ end }}</code></pre>
</div>
<div id="list.html" class="section level3">
<h3>list.html</h3>
<p>I didn’t like that the “About” page was included on the landing page. Following <a href="https://discuss.gohugo.io/t/exclude-post-type/5194/2" class="uri">https://discuss.gohugo.io/t/exclude-post-type/5194/2</a>, I copied <code>./themes/beautifulhugo/layouts/_default/list.html</code> to <code>./layouts/_default/list.html</code> and changed the line <code>{{ range .Paginator.Pages }}</code> to <code>{{ range where .Paginator.Pages &quot;Type&quot; &quot;eq&quot; &quot;post&quot;}}</code><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>.</p>
<p>Also, posts in the listing on the landing page looked messy if their first lines contained code. This can be improved by further editing the <code>list.html</code> file, cf. <a href="https://github.com/rstudio/blogdown/issues/21#issuecomment-285747870" class="uri">https://github.com/rstudio/blogdown/issues/21#issuecomment-285747870</a>:</p>
<pre><code>&lt;div class=&quot;post-entry&quot;&gt;
    {{ if .Description }}
        {{ .Description | safeHTML }}
        &lt;a href=&quot;{{ .Permalink }}&quot; class=&quot;post-read-more&quot;&gt;[{{ i18n &quot;readMore&quot; }}]&lt;/a&gt;
    {{ else }}
        {{ if .Truncated }}
            {{ .Summary }}
            &lt;a href=&quot;{{ .Permalink }}&quot; class=&quot;post-read-more&quot;&gt;[{{ i18n &quot;readMore&quot; }}]&lt;/a&gt;
        {{ else }}
            {{ .Content }}
        {{ end }}
    {{ end }}
&lt;/div&gt;</code></pre>
<p>Now, I can add a <code>description: 'Short description to be displayed on the landing page list.'</code> to a YAML header of a post if I don’t want hugo’s automatic summary.</p>
</div>
<div id="logo-and-favicon" class="section level3">
<h3>logo and favicon</h3>
<p>I wanted my own logo and favicon, added them to <code>./static/img</code> and referenced them in <code>config.toml</code>. However, I only managed to have them picked up properly when I deleted all images from <code>./themes/beautifulhugo/static/img</code>. I guess this had something to do with using the theme’s example site and not understanding where in the layout the example images were referred to…</p>
</div>
<div id="rprofile" class="section level3">
<h3>.Rprofile</h3>
<p>I created an <code>.Rprofile</code> file with the following content in the project’s root directory:</p>
<pre><code>options(
    blogdown.author = &quot;Matt Flor&quot;,
    blogdown.rmd = TRUE,
    blogdown.method = &quot;html&quot;
)</code></pre>
<p>That way, new posts will be R Markdown by default and contain my name in the author field. I initially wanted to use the “html_encoded” method (<a href="https://bookdown.org/yihui/blogdown/methods.html#methods" class="uri">https://bookdown.org/yihui/blogdown/methods.html#methods</a>) but something was messing up figure paths so I reverted to the default “html” method…</p>
</div>
</div>
</div>
<div id="deployment" class="section level1">
<h1>Deployment</h1>
<p>To deploy the Hugo-generated website to my server I use a Linux shell script, <code>deploy</code>, similar to the one shown at <a href="https://gohugo.io/tutorials/deployment-with-rsync/" class="uri">https://gohugo.io/tutorials/deployment-with-rsync/</a>:</p>
<pre><code>#!/bin/sh

USER=root
HOST=www.mattflor.de
DIR=var/www/html/

rsync -avz --delete public/ ${USER}@${HOST}:/${DIR}

exit 0</code></pre>
<p>The script will transfer all files in the project’s <code>./public</code> directory to <code>/var/www/html</code> on my server which is Apache’s default document root. Don’t forget to give execution privileges (<code>chmod +x deploy</code>).</p>
</div>
<div id="workflow" class="section level1">
<h1>Workflow</h1>
<ol style="list-style-type: decimal">
<li>Create a “New Post” (RStudio Addin), enter details in the dialog, add <code>draft: true</code> to the YAML frontmatter.</li>
<li>Start local webserver via “Serve Site” (RStudio Addin).</li>
<li>Write post (each time you save the Rmd file, Hugo will automatically update the local site), use <code>git</code> during the writing process as desired.</li>
<li>When satisfied: Remove <code>draft: true</code> and stop the local webserver.</li>
<li>Call <code>blogdown::build_site()</code> (RStudio console).</li>
<li>Run <code>./deploy</code> (Linux command line).</li>
</ol>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In addition, <a href="https://proquestionasker.github.io/blog/Making_Site/" class="uri">https://proquestionasker.github.io/blog/Making_Site/</a> is a great resource.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>With Hugo themes, this is the <a href="https://gohugo.io/themes/customizing/">way to customize</a>.<a href="#fnref2">↩</a></p></li>
</ol>
</div>
